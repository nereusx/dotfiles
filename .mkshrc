# -- mode: sh; tab-size: 4; --
# mksh

# non-interactive
umask 022

# if non-interactive shell, exit
[ -o interactive ] || exit

#
#	MKSH settings
#
set -o emacs
set -o allexport
set -o notify
set -o noclobber
set -o utf8-mode
set -o nounset
set +o errexit

# keyboard
bind '^Q'=abort
bind '^[q'=quote
bind '^[d'=kill-line
bind '^[k'=kill-to-eol
#bind '^K'=kill-to-bol
#bind '^[i'=
bind '^[p'=search-history-up
bind '^[l'=downcase-word
bind '^[m'=set-mark-command
bind '^[[2~'=yank

# load ~/.posix-shell/*
for script in ~/.posix-shell/*.sh; do
	[ -x $script ] && . $script
done

#
#	PROMPT
#
PROMPT_COMMAND=()
x=$(print \\001)
red="$x$(tput setaf 1)$x"
green="$x$(tput setaf 2)$x"
yellow="$x$(tput setaf 3)$x"
blue="$x$(tput setaf 4)$x"
rst="$x$(tput sgr0)$x"

PS1="$x$(print \\r)$x$(tput bold)$x"
if [ $USERID -eq 0 ]; then PS1+=$red; else PS1+=$green; fi
PS1+='$USER'
if [ -n "${SSH_CONNECTION-}" ]; then
	PS1+=$yellow'@$HOSTNAME'
else
	PS1+=$green'@$HOSTNAME'
fi
PS1+=$blue' $PWD '$rst
if [ $USERID -eq 0 ]; then PS1+='# '; else PS1+='$ '; fi

unset x red green yellow blue rst

# more aliases
alias sleep="$(command -vp sleep)"
alias reload='. ~/.mkshrc'

# load local mkshrc files
for e in ~/.mkshrc-*; do
	if [ -f $e ]; then
		. $e
	fi
done

#	welcome screen
if [ -o login ]; then
	[[ $TTY == tty* ]] && /bin/echo -ne '\033='
	echo "Welcome to $KSH_VERSION"
	echo
	list="neofetch screenfetch diogenis fortunes"
	for f in $list; do
		if [ $(command -vp $f) ]; then
			$f;
			break
		fi
	done
fi
