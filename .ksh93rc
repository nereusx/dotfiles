# -- mode: sh; tab-size: 4; --
# AT&T's ksh93 startup

umask 022

# if non-interactive shell, exit
[[ $- == *i* ]] || return

set -o emacs
set -o allexport
#set -o errexit

[ -r ~/.environ ] && . ~/.environ

### Terminal & Keys
[[ $TERM == "rxvt" ]] && TERM=rxvt-unicode
function keyboard_trap {
case ${.sh.edchar} in
$'\e'[[O]F)   .sh.edchar=$'\cE';; # [END] = end-of-line
$'\e'[[\[]3~) .sh.edchar=$'\cD';; # [DEL] = delete-character
esac
}
trap keyboard_trap KEYBD

# load ~/.posix-shell/*
for script in ~/.posix-shell/*.sh; do
	[ -x $script ] && . $script
done

# PROMPT
#PS1='
#${LOGNAME}@${HOSTNAME} on ${TTY}
#[${PWD}] '
# smul/rmul = underline, sitm/ritm = italics
# bold, setaf (forground), setab (background), op (reset)
PS1='$(tput bold)$(tput setaf 2)${USER:=$(id -un)}'"@${HOSTNAME:=$(hostname)}$(tput op)"
PS1=$PS1' $PWD '
if [[ $USER == root ]]; then
	PS1+="\# "
else
	PS1+="\$ "
fi

# aliases
[ -r ~/.aliases ] && . ~/.aliases
alias reload='. ~/.ksh93rc'

# welcome screen
if [[ -o login ]]; then
	[[ $TTY == tty* ]] && /bin/echo -ne '\033='
	echo "Welcome to Korn Shell $KSH_VERSION"
	echo
	set -A list neofetch screenfetch diogenis fortunes
	for f in ${list[@]}; do
		if [[ -x $(command -vp $f) ]]; then
			$f;
			break
		fi
	done
fi

# load local kshrc files
for e in ~/.ksh93rc-*; do
	if [[ -f $e ]]; then
		. $e
	fi
done
